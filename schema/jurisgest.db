-- Crear la base de datos
CREATE DATABASE jurisgest;

-- Seleccionar la base de datos
USE jurisgest;

-- Crear las tablas seg√∫n el diagrama
CREATE TABLE tbl_junt (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nJunt VARCHAR(255)
);

CREATE TABLE tbl_per (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nPer VARCHAR(255)
);

CREATE TABLE tbl_usr (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usr VARCHAR(225),
    aco VARCHAR(255),
    nom VARCHAR(255),
    ape VARCHAR(255),
    perf INT,
    corr VARCHAR(255),
    fReg DATE,
    fUlt DATE,
    FOREIGN KEY (perf) REFERENCES tbl_per(id)
);

CREATE TABLE tbl_cli (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(255),
    aPat VARCHAR(255),
    aMat VARCHAR(255),
    calle VARCHAR(255),
    nInt VARCHAR(255),
    nExt VARCHAR(255),
    col VARCHAR(255),
    cp VARCHAR(255),
    ciud VARCHAR(255),
    edo VARCHAR(255),
    tel1 VARCHAR(255),
    tel2 VARCHAR(255),
    cel VARCHAR(255),
    corr VARCHAR (255),
    fReg DATE
);

CREATE TABLE tbl_exp (
    id INT AUTO_INCREMENT PRIMARY KEY,
    fInt DATE,
    nom VARCHAR(255),
    ape VARCHAR(255),
    emp VARCHAR(255),
    jun INT,
    varch VARCHAR(255),
    sta VARCHAR(255),
    cliente_id INT,
    FOREIGN KEY (jun) REFERENCES tbl_junt(id),
    FOREIGN KEY (cliente_id) REFERENCES tbl_cli(id)
);

CREATE TABLE tbl_aud (
    id INT AUTO_INCREMENT PRIMARY KEY,
    fAud DATE,
    jun INT,
    cli INT,
    exp INT,
    nAud VARCHAR(255),
    com VARCHAR(255),
    FOREIGN KEY (jun) REFERENCES tbl_junt(id),
    FOREIGN KEY (cli) REFERENCES tbl_cli(id),
    FOREIGN KEY (exp) REFERENCES tbl_exp(id)
);

-- Inserta los tres roles de usuarios
INSERT INTO tbl_per(nPer) VALUES ("super_administrador");
INSERT INTO tbl_per(nPer) VALUES ("administrador");
INSERT INTO tbl_per(nPer) VALUES ("usuario");

-- Inserta super administrador por defecto

INSERT INTO tbl_usr(usr, aco, nom, ape, perf, corr, fReg, fUlt) VALUES ("TzRooDAI", "$2y$10$Y8IxxVE8QPvaWlGO7AGqbOoC0b4IfdRbbLHgfElI4NelXhQ/HWaWm", "gerardo", "cuellar", 1, "gerardo.cuellar@gmail.com", "2024-05-28", "2024-05-28");